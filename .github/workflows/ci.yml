name: CI

on:
    push:
        branches: [main]
    pull_request:
        branches: [main]

jobs:
    php-lint-and-standards:
        runs-on: ubuntu-latest
        strategy:
            matrix:
                php: ['7.4', '8.2']
        steps:
            - name: ğŸ§± Checkout repository
              uses: actions/checkout@v4

            - name: ğŸ§° Setup PHP
              uses: shivammathur/setup-php@v2
              with:
                  php-version: ${{ matrix.php }}
                  tools: composer
                  coverage: none

            - name: ğŸ§© Configure Composer plugins
              run: composer global config --no-plugins allow-plugins.dealerdirect/phpcodesniffer-composer-installer true

            - name: ğŸª¶ Install PHPCS & WPCS
              run: |
                  composer global require --no-interaction --no-progress \
                    squizlabs/php_codesniffer:^3.9 \
                    wp-coding-standards/wpcs:^3.0 \
                    phpcsstandards/phpcsextra:^1.4 \
                    phpcsstandards/phpcsutils:^1.1
                  ~/.composer/vendor/bin/phpcs --config-set installed_paths \
                    ~/.composer/vendor/wp-coding-standards/wpcs,~/.composer/vendor/phpcsstandards/phpcsextra,~/.composer/vendor/phpcsstandards/phpcsutils

            - name: ğŸ§ª PHP Syntax Check
              run: find . -type f -name "*.php" -not -path "./vendor/*" -print0 | xargs -0 -n1 -P4 php -l

            - name: ğŸ” PHPCS Validation
              run: ~/.composer/vendor/bin/phpcs --standard=phpcs.xml.dist .
